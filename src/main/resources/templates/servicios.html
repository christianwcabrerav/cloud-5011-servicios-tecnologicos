<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cloud 5011 | Dashboard de Servicios</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <style>
        :root { --brand:#0d6efd; }
        body { background: #0b1220; }
        .app-shell { min-height: 100vh; }
        .sidebar {
          background: rgba(255,255,255,.06);
          border-right: 1px solid rgba(255,255,255,.08);
          backdrop-filter: blur(8px);
        }
        .sidebar .nav-link { color: rgba(255,255,255,.78); }
        .sidebar .nav-link.active, .sidebar .nav-link:hover { color: #fff; background: rgba(13,110,253,.18); }
        .content {
          background: radial-gradient(1200px 600px at 20% 0%, rgba(13,110,253,.18), transparent 60%),
                      radial-gradient(900px 450px at 90% 10%, rgba(32,201,151,.14), transparent 55%),
                      #0b1220;
        }
        .card-glass {
          background: rgba(255,255,255,.06);
          border: 1px solid rgba(255,255,255,.10);
          color: rgba(255,255,255,.92);
          backdrop-filter: blur(10px);
          border-radius: 16px;
        }
        .muted { color: rgba(255,255,255,.68); }
        .table-darkish { --bs-table-bg: rgba(255,255,255,.03); --bs-table-border-color: rgba(255,255,255,.10); }
        .form-control, .form-select {
          background: rgba(255,255,255,.06);
          border: 1px solid rgba(255,255,255,.12);
          color: rgba(255,255,255,.92);
        }
        .form-control::placeholder { color: rgba(255,255,255,.55); }
        .form-control:focus {
          border-color: rgba(13,110,253,.55);
          box-shadow: 0 0 0 .25rem rgba(13,110,253,.18);
          background: rgba(255,255,255,.08);
          color: #fff;
        }
        .badge-soft {
          background: rgba(13,110,253,.18);
          border: 1px solid rgba(13,110,253,.28);
          color: #dbeafe;
        }
        .btn-brand {
          background: linear-gradient(135deg, rgba(13,110,253,.95), rgba(32,201,151,.75));
          border: 0;
        }
        .btn-brand:hover { filter: brightness(1.05); }
        .divider { height:1px; background: rgba(255,255,255,.10); }
    </style>
</head>

<body>
<div class="container-fluid app-shell">
    <div class="row g-0">

        <!-- Sidebar -->
        <aside class="col-12 col-lg-2 p-3 sidebar">
            <div class="d-flex align-items-center gap-2 mb-3">
                <div class="rounded-3 d-flex align-items-center justify-content-center" style="width:40px;height:40px;background:rgba(13,110,253,.25);border:1px solid rgba(13,110,253,.35);">
                    <i class="bi bi-cloud-check fs-4 text-white"></i>
                </div>
                <div>
                    <div class="fw-semibold text-white">Cloud 5011</div>
                    <div class="small muted">Servicios Tecnológicos</div>
                </div>
            </div>

            <div class="divider my-3"></div>

            <nav class="nav flex-column gap-1">
                <a class="nav-link active rounded-3 px-3 py-2" href="#">
                    <i class="bi bi-speedometer2 me-2"></i> Dashboard
                </a>
                <a class="nav-link rounded-3 px-3 py-2" href="#nuevo">
                    <i class="bi bi-plus-circle me-2"></i> Nuevo servicio
                </a>
                <a class="nav-link rounded-3 px-3 py-2" href="#lista">
                    <i class="bi bi-table me-2"></i> Listado
                </a>
            </nav>

            <div class="divider my-3"></div>

            <div class="small muted">
                <div class="d-flex align-items-center justify-content-between">
                    <span>Entorno</span>
                    <span class="badge badge-soft">Azure</span>
                </div>
                <div class="mt-2">
                    <i class="bi bi-database-check me-1"></i> Azure SQL Database
                </div>
                <div class="mt-1">
                    <i class="bi bi-globe2 me-1"></i> App Service
                </div>
            </div>
        </aside>

        <!-- Main content -->
        <main class="col-12 col-lg-10 content p-3 p-lg-4">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                <div>
                    <h1 class="h3 text-white mb-1">Dashboard</h1>
                    <div class="muted">Gestión simple y funcional de servicios (PoC) desplegada en Azure.</div>
                </div>
                <div class="d-flex align-items-center gap-2">
          <span class="badge badge-soft">
            <i class="bi bi-shield-lock me-1"></i> Conexión segura (SSL)
          </span>
                </div>
            </div>

            <!-- KPI cards -->
            <div class="row g-3 mb-3">
                <div class="col-12 col-md-4">
                    <div class="card card-glass p-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <div class="muted small">Total de servicios</div>
                                <div class="fs-3 fw-semibold" th:text="${#lists.size(servicios)}">0</div>
                            </div>
                            <div class="rounded-3 d-flex align-items-center justify-content-center"
                                 style="width:46px;height:46px;background:rgba(32,201,151,.18);border:1px solid rgba(32,201,151,.28);">
                                <i class="bi bi-collection fs-4 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-4">
                    <div class="card card-glass p-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <div class="muted small">Último precio registrado</div>
                                <div class="fs-3 fw-semibold">
                                    S/ <span th:text="${#lists.isEmpty(servicios) ? 0 : servicios[servicios.size()-1].precio}">0</span>
                                </div>
                            </div>
                            <div class="rounded-3 d-flex align-items-center justify-content-center"
                                 style="width:46px;height:46px;background:rgba(13,110,253,.18);border:1px solid rgba(13,110,253,.28);">
                                <i class="bi bi-cash-coin fs-4 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-4">
                    <div class="card card-glass p-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <div class="muted small">Estado del servicio</div>
                                <div class="fs-3 fw-semibold">
                                    <span class="text-success">Online</span>
                                </div>
                            </div>
                            <div class="rounded-3 d-flex align-items-center justify-content-center"
                                 style="width:46px;height:46px;background:rgba(255,193,7,.16);border:1px solid rgba(255,193,7,.26);">
                                <i class="bi bi-activity fs-4 text-white"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form + Table -->
            <div class="row g-3">
                <!-- Form -->
                <div class="col-12 col-xl-4" id="nuevo">
                    <div class="card card-glass p-3 p-lg-4 h-100">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <h2 class="h5 mb-0 text-white"><i class="bi bi-plus-circle me-2"></i>Nuevo servicio</h2>
                            <span class="badge badge-soft">CRUD básico</span>
                        </div>
                        <div class="muted small mb-3">Registra servicios y valida persistencia en Azure SQL.</div>

                        <form th:action="@{/servicios}" method="post">
                            <div class="mb-3">
                                <label class="form-label muted">Nombre</label>
                                <input class="form-control" name="nombre" placeholder="Ej. Soporte remoto" required />
                            </div>

                            <div class="mb-3">
                                <label class="form-label muted">Precio (S/)</label>
                                <input class="form-control" name="precio" type="number" step="0.01" min="0" placeholder="Ej. 49.90" required />
                            </div>

                            <button type="submit" class="btn btn-brand w-100 py-2">
                                <i class="bi bi-save2 me-2"></i> Guardar
                            </button>
                        </form>

                        <div class="divider my-4"></div>

                        <div class="small muted">
                            <div class="d-flex gap-2 align-items-center">
                                <i class="bi bi-info-circle"></i>
                                <span>Tip: usa el buscador para filtrar rápidamente.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Table -->
                <div class="col-12 col-xl-8" id="lista">
                    <div class="card card-glass p-3 p-lg-4">
                        <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
                            <h2 class="h5 mb-0 text-white"><i class="bi bi-table me-2"></i>Listado de servicios</h2>

                            <div class="d-flex gap-2 align-items-center">
                                <div class="input-group">
                  <span class="input-group-text" style="background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);color:rgba(255,255,255,.85);">
                    <i class="bi bi-search"></i>
                  </span>
                                    <input id="filterInput" class="form-control" placeholder="Buscar por nombre..." />
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-darkish table-hover align-middle mb-0">
                                <thead>
                                <tr class="muted">
                                    <th style="width:80px;">ID</th>
                                    <th>Nombre</th>
                                    <th style="width:160px;" class="text-end">Precio (S/)</th>
                                </tr>
                                </thead>
                                <tbody id="tableBody">
                                <tr th:each="s : ${servicios}">
                                    <td class="muted" th:text="${s.id}">1</td>
                                    <td>
                                        <div class="fw-semibold text-white" th:text="${s.nombre}">Servicio</div>
                                        <div class="muted small">Catálogo operativo</div>
                                    </td>
                                    <td class="text-end text-white fw-semibold" th:text="${s.precio}">0</td>
                                </tr>

                                <tr th:if="${#lists.isEmpty(servicios)}">
                                    <td colspan="3" class="muted text-center py-4">
                                        <i class="bi bi-inbox me-1"></i> Aún no hay servicios registrados.
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mt-3 muted small">
                            <span><i class="bi bi-cloud-check me-1"></i> Desplegado en Azure App Service</span>
                            <span><i class="bi bi-database-check me-1"></i> Persistencia: Azure SQL Database</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4 muted small">
                © 2026 · Cloud Computing 5011 · Chris Tech CWCV
            </div>
        </main>
    </div>
</div>

<script>
    // Filtro instantáneo por nombre (sin backend)
    const filterInput = document.getElementById('filterInput');
    const tbody = document.getElementById('tableBody');

    filterInput?.addEventListener('input', () => {
      const q = filterInput.value.toLowerCase().trim();
      const rows = tbody.querySelectorAll('tr');

      rows.forEach(row => {
        // ignora filas "empty"
        const nameCell = row.querySelector('td:nth-child(2) .fw-semibold');
        if (!nameCell) return;

        const txt = nameCell.textContent.toLowerCase();
        row.style.display = txt.includes(q) ? '' : 'none';
      });
    });
</script>

</body>
</html>